{"version":3,"sources":["../source/wizard.js"],"names":["makeURL","uri","uriField","document","getElementById","inputVals","Array","from","getElementsByClassName","map","x","id","encodeURIComponent","value","window","location","protocol","hostname","pathname","join","calculator","remainder","svgRemainder","fields","vals","Map","forEach","f","length","set","decimals","key","amount","indexOf","decParts","parts","split","parseInt","fractionToNumber","label","textContent","fractioned","difference","get","values","reduce","a","b","numberToFraction","Math","abs","classList","add","setAttribute","remove","bits","parseFloat","gcd","floor","len","toString","denominator","pow","numerator","divisor","base","svg","not","group","svgEl","notEl","groupEl","labelEl","svgDiff","dataset","height","yPosition","getAttribute","style","display","y2","addEventListener","getElementsByTagName","href","includes","URL","searchParams","y","decodeURIComponent","setFromHref","btn","querySelector","canvas","ctx","getContext","data","XMLSerializer","serializeToString","DOMURL","webkitURL","img","Image","svgBlob","Blob","type","url","createObjectURL","onload","clearRect","drawImage","revokeObjectURL","imgURI","evt","MouseEvent","view","bubbles","cancelable","createElement","dispatchEvent","triggerDownload","toDataURL","replace","src"],"mappings":"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","sourcesContent":["/*\n* )                )       )\n* ( /(   (  (      ( /(    ( /(   (\n* )\\())  )\\))(   ' )\\())   )\\())  )\\ )\n* ((_)\\  ((_)()\\ ) ((_)\\   ((_)\\  (()/(\n* _((_) _(())\\_)()  ((_)   _((_)  /(_))_\n* | \\| | \\ \\((_)/ / / _ \\  | \\| | (_)) __|\n* | .` |  \\ \\/\\/ / | (_) | | .` |   | (_ |\n* |_|\\_|   \\_/\\_/   \\___/  |_|\\_|    \\___|\n*\n* Created by Nathan Wong\n* https://nathanwong.studio\n*\n* Frame Depth Calculator v. 2.0\n* Copyright 2020 Nathan Wong\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy of\n* this software and associated documentation files (the \"Software\"), to deal in the\n* Software without restriction, including without limitation the rights to use, copy,\n* modify, merge, publish, distribute, sublicense, and/or sell copies of the Software,\n* and to permit persons to whom the Software is furnished to do so, subject to the\n* following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n* INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n* PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n* SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*\n*/\n\nwindow.addEventListener(\"load\", eventWindowLoaded, false);\nwindow.addEventListener(\"change\", calculator, false);\nwindow.addEventListener(\"change\", makeURL, false);\n\nfunction eventWindowLoaded() {\n\n  // Adding Data- attribute to SVG elements with their intial heights\n\n  var svgRect = Array.from(document.getElementsByTagName(\"rect\"));\n\n  svgRect.forEach((x) => {\n\n    var height = x.getAttribute('height');\n\n    x.setAttribute('data-height', height);\n\n  });\n  setFromHref();\n  calculator();\n  downloadSVG();\n  makeURL();\n\n}\n\nfunction setFromHref() {\n  if(window.location.href.includes(\"?rabbet\")){\n    (new URL(window.location.href)).searchParams.forEach((x, y) =>\n      document.getElementById(y).value = decodeURIComponent(x));\n  }\n  calculator();\n}\n\n//Make a URL from the form elements\nfunction makeURL() {\n  var uri;\n  var uriField = document.getElementById('url');\n\n  var input = Array.from(document.getElementsByClassName('values'));\n\n  var inputVals = input.map(function(x) {\n    return x.id + \"=\" + encodeURIComponent(x.value);\n  });\n\n  uri =window.location.protocol + '//' + window.location.hostname + window.location.pathname + '?' + inputVals.join('&');\n\n  uriField.value = uri;\n\n}\n\n\n\n/** Calculator\n *** This function calculates the difference between the rabbet depth and the\n *** package depth and outputs a user-friendly fraction.\n **/\n\nfunction calculator() {\n\n  // var form = document.getElementById('frameCalc');\n  var remainder = document.getElementById('remaining'),\n  svgRemainder = document.getElementById('measurement-remainder'),\n  fields = Array.from(document.getElementsByClassName(\"values\"));\n\n  //make key-value\n  let vals = new Map();\n\n  fields.forEach((f) => {\n    if (f.value == 0 || f.value.length == 0) {\n      f.value = 0;\n    }\n    vals.set(f.id, f.value);\n  });\n\n  //convert to decimals\n  let decimals = new Map();\n\n  vals.forEach((value, key) => {\n    var x = fractionToNumber(value);\n\n    decimals.set(key, x);\n\n    var label = 'measurement-' + key,\n        labelEl = document.getElementById(label);\n\n    labelEl.textContent = value + \"\\x22\";\n\n  });\n\n  // find the difference\n  var rabbet = decimals.get('rabbet'),\n      sum = Array.from(decimals.values()).reduce(function(a, b) {\n        return a + b;\n      },0),\n      difference = (2 * rabbet) - sum;\n\n  //Insert the Number\n\n  var fractioned;\n  var nonNeg;\n\n  if (difference < 0) {\n    nonNeg = Math.abs(difference)\n\n    fractioned = numberToFraction(nonNeg)\n\n    remainder.value = \"-\" + fractioned + '\\x22'\n    svgRemainder.textContent = \"-\" + fractioned + '\\x22'\n\n    remainder.classList.add('negative')\n\n    svgRemainder.setAttribute(\"class\", 'negative')\n\n  } else {\n\n    fractioned = numberToFraction(difference)\n\n    remainder.value = fractioned + '\\x22'\n    svgRemainder.textContent = fractioned + '\\x22'\n\n    remainder.classList.remove('negative')\n\n    svgRemainder.setAttribute(\"class\", 'positive')\n  }\n\n  //take decimal number and convert to bits\n\n  var bits = new Map();\n  decimals.forEach((value, key) => {\n    bits.set(key, value * 64)\n  });\n\n  //Assign heights, visibility, and labels\n  bits.forEach((value, key) => {\n    var svg = 'svg-' + key,\n        not = 'not-' + key,\n        group = key + '-group',\n        label = 'measurement-' + key,\n        svgEl = document.getElementById(svg),\n        notEl = document.getElementById(not),\n        groupEl = document.getElementById(group),\n        labelEl = document.getElementById(label),\n        svgDiff = value - parseFloat(svgEl.dataset.height),\n        y = parseFloat(svgEl.getAttribute('y')),\n        yPosition = value / 2 + y + 1;\n\n    svgEl.setAttribute('height', value);\n\n    if (key != 'rabbet') {\n      notEl.setAttribute('transform', 'translate(0 ' + svgDiff + ')');\n\n      labelEl.setAttribute('y', yPosition);\n\n      if (value == 0) {\n        groupEl.style.display = 'none';\n      } else {\n        groupEl.style.display = 'inline';\n      }\n    }\n    if (key == 'strainer') {\n      var y1 = parseFloat(document.getElementById('svg-x').getAttribute('y1')),\n          y2 = y1 + value;\n      document.getElementById('svg-x').setAttribute('y2', y2);\n    }\n    // console.log(svgEl)\n  });\n\n\n\n  /**\n   *\n   * Convert Fraction to Number\n   *\n   **/\n  function fractionToNumber(amount) {\n    if (amount.indexOf('/') != -1) {\n      var parts = amount.split(\" \")\n      var decParts;\n      if (parts.length > 1) {\n        decParts = parts[1].split(\"/\");\n      } else {\n        decParts = parts[0].split(\"/\");\n        parts[0] = 0;\n      }\n      return parseInt(parts[0], 10) + (parseInt(decParts[0], 10) / parseInt(decParts[1], 10));\n    } else {\n      return parseInt(amount, 10)\n    }\n  }\n\n  /**\n   * Converts numbers to fractions:\n   * - 1.25 to 1 1/4\n   * - 2 to 2\n   */\n  function numberToFraction(amount) {\n    // This is a whole number and doesn't need modification.\n    if (parseFloat(amount) === parseInt(amount)) {\n      return amount;\n    }\n    // Next 12 lines are cribbed from https://stackoverflow.com/a/23575406.\n    var gcd = function(a, b) {\n      if (b < 0.0000001) {\n        return a;\n      }\n      return gcd(b, Math.floor(a % b));\n    };\n    var len = amount.toString().length - 2;\n    var denominator = Math.pow(10, len);\n    var numerator = amount * denominator;\n    var divisor = gcd(numerator, denominator);\n    numerator /= divisor;\n    denominator /= divisor;\n    var base = 0;\n    // In a scenario like 3/2, convert to 1 1/2\n    // by pulling out the base number and reducing the numerator.\n    if (numerator > denominator) {\n      base = Math.floor(numerator / denominator);\n      numerator -= base * denominator;\n    }\n    amount = Math.floor(numerator) + '/' + Math.floor(denominator);\n    if (base) {\n      amount = base + ' ' + amount;\n    }\n    return amount;\n  }\n\n}\n\n/* SVG to PNG and Download\n ** Converts the SVG to a PNG\n ** Links straight to download.\n ** Doesn't work on iOS yet, haven't tested on android.\n */\n\nfunction downloadSVG() {\n  var btn = document.getElementById('download');\n  var svg = document.querySelector('svg');\n\n  function triggerDownload(imgURI) {\n    var evt = new MouseEvent('click', {\n      view: window,\n      bubbles: false,\n      cancelable: true\n    });\n\n    var a = document.createElement('a');\n    a.setAttribute('download', 'frame-diagram.png');\n    a.setAttribute('href', imgURI);\n    a.setAttribute('target', '_blank');\n\n    a.dispatchEvent(evt);\n  }\n\n  btn.addEventListener('click', function() {\n    var canvas = document.getElementById('downloadable');\n    var ctx = canvas.getContext('2d');\n    var data = (new XMLSerializer()).serializeToString(svg);\n    var DOMURL = window.URL || window.webkitURL || window;\n\n    var img = new Image();\n    var svgBlob = new Blob([data], {\n      type: 'image/svg+xml;charset=utf-8'\n    });\n    var url = DOMURL.createObjectURL(svgBlob);\n\n    img.onload = function() {\n      ctx.clearRect(0, 0, 1800, 2000);\n      ctx.drawImage(img, 0, 0, 1800, 2000);\n      DOMURL.revokeObjectURL(url);\n\n      var imgURI = canvas\n        .toDataURL('image/png')\n        .replace('image/png', 'image/octet-stream');\n\n      triggerDownload(imgURI);\n    };\n\n    img.src = url;\n  }, false);\n}\n"]}